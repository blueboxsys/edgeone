# Requests without the “Host” header field should not be allowed, a server that just drops the requests, can be defined:
# server { letsencrypted stopped working so commented this rule
#     listen      80;
#     server_name "";
#     return      444;
# }


  # Internal server running on port 8999 for handling certificate tasks.
  server {
    listen 127.0.0.1:8999;

    # Increase the body buffer size, to ensure the internal POSTs can always
    # parse the full POST contents into memory.
    client_body_buffer_size 128k;
    client_max_body_size 128k;

    location / {
      content_by_lua_block {
        auto_ssl:hook_server()
      }
    }
  }

server
{
   	listen 80 default_server;	#http2 proxy_protocol
	#prod config listen 80 default_server http2;	#proxy_protocol
    listen [::]:80 ipv6only=on default_server;
    server_name	_;
    root html;

    index index.html index.php;
    include nginx-core.d/headers.conf;

    return 200 "Edgeone server is healthy ok!";

    #access_log      /tmp/access.log trace buffer=32k flush=5s; # Log $request_id
	#access_log on;
	access_log off;

	include nginx-ssl.d/autossl.conf;

	include nginx-core.d/gtg.conf;
	include nginx-core.d/php7.conf;
}
